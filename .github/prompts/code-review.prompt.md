# Code Review

このブランチで行った作業を包括的にレビューしてください。

## レビューの視点

### 1. コード品質と標準準拠
以下のガイドラインに基づいてコードの品質を評価してください：
- `/.github/instructions/typescript.instructions.md`

### 2. アーキテクチャ設計
- **SOLID原則**: 単一責任、オープン/クローズド、リスコフの置換、インターフェイス分離、依存性逆転の各原則への準拠
- **クリーンアーキテクチャ**: レイヤー分離、依存関係の方向性、ビジネスロジックの独立性
- **保守性**: コードの読みやすさ、変更のしやすさ、技術的負債の有無
- **拡張性**: 新機能追加時の柔軟性、既存コードへの影響範囲

### 3. テスト品質
- **カバレッジ**: 重要なビジネスロジック、エッジケース、エラーハンドリングのカバレッジ
- **テストの質**: テストの独立性、可読性、保守性
- **テストパターン**: Arrange-Act-Assert、モックやスタブの適切な使用
- **統合テスト**: 必要に応じた統合テストの有無

### 4. セキュリティ
- 認証・認可の実装
- 入力検証とサニタイゼーション
- 機密情報の取り扱い
- セキュアなコーディングプラクティス

### 5. パフォーマンス
- アルゴリズムの効率性
- データベースクエリの最適化
- リソース管理（メモリ、接続など）
- 非同期処理の適切な使用

### 6. エラーハンドリングとロギング
- 例外処理の適切性
- エラーメッセージの有用性
- ログ出力の適切性
- デバッグのしやすさ

## レビュー実施手順

1. **変更内容の把握**
   まず、以下の方法で現在のブランチの変更内容を正確に特定してください：

   a. **現在のブランチを確認**
      - `run_in_terminal`で`git branch --show-current`を実行し、レビュー対象のブランチ名を確認

   b. **ベースブランチとの差分を確認**
      - `run_in_terminal`で`git diff main...HEAD --name-status`を実行（mainがベースブランチの場合）
      - または`get_changed_files`ツールを使用（未コミット変更の確認）

   c. **未追跡ファイルを確認**
      - `run_in_terminal`で`git status --short`を実行し、untrackedファイルも含めて確認

   d. **コミット履歴を確認**
      - `run_in_terminal`で`git log main..HEAD --oneline`を実行し、ベースブランチからの新しいコミットを確認

   e. **主要な変更点を特定**
      - 上記a〜dの結果を総合して、レビュー対象のファイルと変更内容を特定
      - 変更がない場合や意図しない変更が含まれている場合は、ユーザーに確認を求める

2. **詳細レビュー**
   - 特定した各ファイルの変更内容を精査
   - 必要に応じて`read_file`や`grep_search`で関連コードを確認
   - 上記の視点に基づいて評価

3. **評価とフィードバック**
   - 以下の各項目を5段階（1-5、5が最高）で評価：
     - **コード品質**: 標準準拠、可読性、命名規則
     - **アーキテクチャ設計**: SOLID原則、クリーンアーキテクチャ、保守性、拡張性
     - **テスト品質**: カバレッジ、テストの質、テストパターン
     - **セキュリティ**: セキュアなコーディングプラクティス
     - **パフォーマンス**: 効率性、最適化
     - **エラーハンドリング**: 例外処理、ログ出力

   - 各項目について：
     - **高評価の点**: 優れている点を具体的に指摘
     - **改善点**: 改善が必要な点があれば具体的に指摘し、改善案を提示

## 出力フォーマット

レビュー結果は日本語で、以下の形式で出力してください：

```markdown
# コードレビュー結果

## 変更内容の概要
[変更されたファイルと主な変更内容を簡潔に記載]

## 評価

### コード品質: X/5
**高評価の点:**
- [具体的な良い点]

**改善点:**
- [改善が必要な点と改善案]

### アーキテクチャ設計: X/5
**高評価の点:**
- [SOLID原則やクリーンアーキテクチャの観点から優れている点]

**改善点:**
- [保守性や拡張性の観点から改善できる点]

### テスト品質: X/5
**高評価の点:**
- [テストカバレッジや品質で優れている点]

**改善点:**
- [テストの追加や改善が必要な点]

### セキュリティ: X/5
**高評価の点:**
- [セキュリティ対策で優れている点]

**改善点:**
- [セキュリティ上の懸念点と対策]

### パフォーマンス: X/5
**高評価の点:**
- [パフォーマンス面で優れている点]

**改善点:**
- [最適化の余地がある点]

### エラーハンドリング: X/5
**高評価の点:**
- [エラーハンドリングで優れている点]

**改善点:**
- [改善が必要な点]

## 総合評価
[総合的な評価と総括]

## 推奨アクション
[マージ前に対応すべき重要な改善点があれば記載]
```

## 注意事項

- 批判的になりすぎず、建設的なフィードバックを心がける
- 具体的なコード例を示して説明する
- 改善点には必ず実践的な解決策を提示する
- ポジティブな点も積極的に評価する
- コンテキストを考慮し、過度に厳格にならない
